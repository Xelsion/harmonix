<?php
use lib\App;
use lib\classes\Language;

$lang = App::getInstance(Language::class);

$this->set("title", "Benutzer bearbeiten");
$type_options = $this->get("type_options");
$connection_options = $this->get("connection_options");
$actor = $this->get("actor");
?>
<div class="container-fluid">
	<h1>Neuen Benutzer anlegen</h1>
	<form action="/actors/<?= $actor->id ?>" method="POST" class="needs-validation" autocomplete="off" novalidate>
		<div class="form-group row">
			<label for="type_id">Type</label>
			<select id="type_id" name="type_id">
				<?php foreach( $type_options as $option ) { ?>
					<option value="<?= $option->id ?>"<?= ( $option->id === $actor->type_id ) ? ' selected="selected"' : '' ?>><?= escaped_html($option->name)  ?></option>
				<?php } ?>
			</select>
			<div class="invalid-feedback"><?= $lang->getValue("error-messages", "type") ?></div>
		</div>
		<div class="form-group row">
			<label for="email">E-Mail</label>
			<input type="email" name="email" value="<?= escaped_html($actor->email) ?>" id="email" required />
			<div class="invalid-feedback"><?= $lang->getValue("error-messages", "email") ?></div>
		</div>
		<div class="form-group row">
			<label for="password">Passwort</label>
			<input type="password" name="password" value="" autocomplete="new-password" id="password" />
			<div class="invalid-feedback"><?= $lang->getValue("error-messages", "password") ?></div>
		</div>
		<div class="form-group row">
			<label for="password_verify">Passwort Wiederholung</label>
			<input type="password" name="password_verify" value="" autocomplete="new-password" id="password_verify" />
			<div class="invalid-feedback"><?= $lang->getValue("error-messages", "password_verify") ?></div>
		</div>
		<div class="form-group row">
			<label for="first_name">Vorname</label>
			<input type="text" name="first_name" value="<?= escaped_html($actor->first_name) ?>" id="first_name" required />
			<div class="invalid-feedback"><?= $lang->getValue("error-messages", "first_name") ?></div>
		</div>
		<div class="form-group row">
			<label for="last_name">Nachname</label>
			<input type="text" name="last_name" value="<?= escaped_html($actor->last_name) ?>" id="last_name" required />
			<div class="invalid-feedback"><?= $lang->getValue("error-messages", "last_name") ?></div>
		</div>
		<div class="form-group row">
			<label for="login_disabled">Login disabled</label>
			<select name="login_disabled" id="login_disabled" required>
				<option value="0"<?= ( !$actor->login_disabled ) ? ' selected="selected"' : ''?>>false</option>
				<option value="1"<?= ( $actor->login_disabled ) ? ' selected="selected"' : ''?>>true</option>
			</select>
			<div class="invalid-feedback"><?= $lang->getValue("error-messages", "selection") ?></div>
		</div>
		<div class="form-group row">
			<label for="login_fails">Login fails</label>
			<input type="number" name="login_fails" value="<?= escaped_html($actor->login_fails) ?>" id="login_fails" required />
		</div>

        <h4>Zusatz Daten</h4>
        <div class="form-group">
            <div class="row">
                <div class="col-2">
                    <label for="data_key_0">Key</label>
                    <input id="data_key_0" type="text" name="actor_data[0][key]" value="" />
                </div>
                <div class="col-2">
                    <label for="data_value_0">Value</label>
                    <input id="data_value_0" type="text" name="actor_data[0][value]" value="" />
                </div>
                <div class="col-2">
                    <label for="data_connection_0">Daten Verbindung</label>
                    <select id="data_connection_0" name="actor_data[0][connection]">
                        <option value="">- keine -</option>
                        <?php foreach( $connection_options as $option ) { ?>
                            <option value="<?= $option->id ?>"><?= $option->name ?></option>
                        <?php } ?>
                    </select>
                </div>
            </div>
            <?php foreach( $actor->data as $entry ) { ?>
                <div class="row">
                    <div class="col-2"><?= $entry->data_key ?></div>
                    <div class="col-2"><?= $entry->data_value ?></div>
                </div>
            <?php } ?>
        </div>
		<div class="form-group row clearfix">
			<div class="col-auto">
				<button type="submit" name="cancel" class="button button-default float-start"><?= $lang->getValue("translations", "cancel") ?></button>
			</div>
			<div class="col"></div>
			<div class="col-auto">
				<button type="submit" name="update" class="button button-positiv float-end"><?= $lang->getValue("translations", "save") ?></button>
			</div>
		</div>
	</form>
</div>
